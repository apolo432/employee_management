{% extends "employees/reports_base.html" %}

{% block page_title %}Панель отчётов{% endblock %}

{% block breadcrumb %}<li class="breadcrumb-item active">Панель</li>{% endblock %}

{% block reports_content %}
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-number">{{ total_employees }}</div>
            <div class="stat-label">Активных сотрудников</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-number">{{ total_summaries }}</div>
            <div class="stat-label">Сводок за {{ current_month }}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-number">{{ total_sessions }}</div>
            <div class="stat-label">Сессий за {{ current_month }}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-number">
                {% for stat in status_stats %}
                    {% if stat.status == 'present' %}{{ stat.count }}{% endif %}
                {% endfor %}
            </div>
            <div class="stat-label">Дней присутствия</div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card report-card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Статистика по статусам</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Статус</th>
                                <th class="text-center">Количество</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in status_stats %}
                            <tr>
                                <td>
                                    <span class="status-badge status-{{ stat.status }}">
                                        {% if stat.status == 'present' %}Присутствовал
                                        {% elif stat.status == 'absent' %}Отсутствовал
                                        {% elif stat.status == 'excused' %}Уважительная причина
                                        {% elif stat.status == 'partial' %}Частично присутствовал
                                        {% elif stat.status == 'problem' %}Проблема
                                        {% endif %}
                                    </span>
                                </td>
                                <td class="text-center">{{ stat.count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card report-card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Топ отделов по часам</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Отдел</th>
                                <th class="text-center">Сотрудников</th>
                                <th class="text-center">Часов</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dept in department_stats|slice:":5" %}
                            <tr>
                                <td>{{ dept.employee__department__name }}</td>
                                <td class="text-center">{{ dept.employees }}</td>
                                <td class="text-center">{{ dept.total_hours|floatformat:1 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center text-muted">Нет данных</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card report-card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Быстрые действия</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'monthly_report' %}" class="btn btn-outline-primary btn-block">
                            <i class="fas fa-calendar-alt"></i> Месячный отчёт
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'employee_report' %}" class="btn btn-outline-success btn-block">
                            <i class="fas fa-user"></i> Отчёт по сотруднику
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'department_report' %}" class="btn btn-outline-warning btn-block">
                            <i class="fas fa-building"></i> Отчёт по отделу
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'work_time_summaries' %}" class="btn btn-outline-info btn-block">
                            <i class="fas fa-list"></i> Просмотр сводок
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{% url 'work_sessions' %}" class="btn btn-outline-secondary btn-block">
                            <i class="fas fa-clock"></i> Рабочие сессии
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/admin/employees/workdaysummary/" class="btn btn-outline-dark btn-block">
                            <i class="fas fa-cog"></i> Админка сводок
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/admin/employees/worksession/" class="btn btn-outline-dark btn-block">
                            <i class="fas fa-cog"></i> Админка сессий
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/api/worktime/" class="btn btn-outline-primary btn-block">
                            <i class="fas fa-code"></i> REST API
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
